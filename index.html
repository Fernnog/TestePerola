<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pérola Rara - Gerenciamento de Pedidos</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon"> <!-- Certifique-se que o caminho ./images/favicon.ico está correto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Adicionando a biblioteca SheetJS (xlsx) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!-- O script principal será type="module" e importará o Firebase -->
    <script type="module" src="./script.js"></script>
</head>
<body>
    <div class="container">
        <!-- ==== INÍCIO SEÇÃO - CABEÇALHO ==== -->
        <header>
            <div class="logo-container">
                <!-- Certifique-se que o caminho ./logo_perola_rara.png está correto -->
                <img src="./logo_perola_rara.png" alt="Logo Pérola Rara" id="logo">
            </div>
            <h1>Pérola Rara</h1>
            <hr class="titulo">
            <nav>
                <!-- Menu será exibido/ocultado pelo script com base no login -->
                <ul style="display: none;">
                    <li><a href="#" data-pagina="form-orcamento">Início</a></li>
                    <li><a href="#" data-pagina="orcamentos-gerados">Orçamentos Gerados</a></li>
                    <li><a href="#" data-pagina="lista-pedidos">Pedidos Realizados</a></li>
                    <li><a href="#" data-pagina="relatorio">Relatório</a></li>
                    <li><button id="btnLogout" style="display:none;">Sair</button></li>
                </ul>
            </nav>
            <hr class="menu">
        </header>
        <!-- ==== FIM SEÇÃO - CABEÇALHO ==== -->

        <!-- Área principal da aplicação (exibida/ocultada pelo script) -->
        <div id="appContent" style="display: none;">

            <!-- ==== INÍCIO SEÇÃO - FORMULÁRIO DE ORÇAMENTO ==== -->
            <section id="form-orcamento" class="pagina">
                <h2>Novo Orçamento</h2>
                <hr class="subtitulo">
                <form id="orcamento">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataOrcamento">Data do Orçamento:</label>
                            <input type="date" id="dataOrcamento" name="dataOrcamento">
                        </div>
                        <div class="form-group">
                            <label for="dataValidade">Data de Validade:</label>
                            <input type="date" id="dataValidade" name="dataValidade">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cliente">Cliente:</label>
                            <input type="text" id="cliente" name="cliente" placeholder="Nome do Cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="endereco">Endereço:</label>
                            <input type="text" id="endereco" name="endereco" placeholder="Endereço do Cliente">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tema">Tema:</label>
                            <input type="text" id="tema" name="tema" placeholder="Tema do Orçamento">
                        </div>
                        <div class="form-group">
                            <label for="cidade">Cidade:</label>
                            <input type="text" id="cidade" name="cidade" placeholder="Cidade do Cliente">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="telefone">Telefone/Celular:</label>
                            <input type="text" id="telefone" name="telefone" placeholder="Número de Telefone ou Celular">
                        </div>
                        <div class="form-group">
                            <label for="clienteEmail">E-mail:</label>
                            <input type="email" id="clienteEmail" name="email" placeholder="Endereço de E-mail">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="width: 100%; margin-right: 0;"> <!-- Ocupa linha inteira -->
                            <label for="cores">Cores:</label>
                            <input type="text" id="cores" name="cores" placeholder="Cores Preferidas">
                        </div>
                    </div>
                    <hr class="tabela">
                    <h3>Produtos do Orçamento</h3>
                    <div class="table-responsive">
                        <table id="tabelaProdutos">
                            <thead>
                                <tr>
                                    <th>Qtde</th>
                                    <th>Descrição do Produto</th>
                                    <th>Valor Unit.</th>
                                    <th>Valor Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Linhas de produtos serão adicionadas aqui pelo JS -->
                            </tbody>
                        </table>
                        <button type="button" id="btnAddProdutoOrcamento">Adicionar Produto</button>
                    </div>
                    <hr class="final-tabela">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pagamento:</label>
                            <div> <!-- Div para agrupar checkboxes -->
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamento" value="pix"> PIX</label>
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamento" value="dinheiro"> Dinheiro</label>
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamento" value="cartaoCredito"> Cartão Crédito</label>
                                <label style="display: inline-block;"><input type="checkbox" name="pagamento" value="cartaoDebito"> Cartão Débito</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="valorFrete">Valor do Frete (R$):</label>
                            <!-- oninput e onblur são tratados pelo JS -->
                            <input type="text" id="valorFrete" name="valorFrete" value="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label for="valorOrcamento">Valor Orçamento (Produtos) (R$):</label>
                            <input type="text" id="valorOrcamento" name="valorOrcamento" value="R$ 0,00" readonly class="campo-calculado">
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group" style="width: 48%; margin-right: 2%;"> <!-- Ajuste para alinhar com outros -->
                            <label for="total">Total Geral (Produtos + Frete) (R$):</label>
                            <input type="text" id="total" name="total" value="R$ 0,00" readonly class="campo-calculado">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="width: 100%; margin-right: 0;">
                            <label for="observacoes">Observações Gerais:</label>
                            <textarea id="observacoes" name="observacoes" rows="4" placeholder="Detalhes adicionais, acordos, etc."></textarea>
                        </div>
                    </div>
                    <button type="button" id="btnGerarOrcamento">Gerar Orçamento</button>
                    <button type="button" id="btnAtualizarOrcamento" style="display: none;">Atualizar Orçamento</button>
                </form>
            </section>
            <!-- ==== FIM SEÇÃO - FORMULÁRIO DE ORÇAMENTO ==== -->

            <!-- ==== INÍCIO SEÇÃO - ORÇAMENTOS GERADOS ==== -->
            <section id="orcamentos-gerados" class="pagina" style="display:none;">
                <h2>Orçamentos Gerados</h2>
                <hr class="subtitulo">
                <div class="filtro-data">
                    <label for="filtroDataInicioOrcamento">Início:</label>
                    <input type="date" id="filtroDataInicioOrcamento">
                    <label for="filtroDataFimOrcamento">Fim:</label>
                    <input type="date" id="filtroDataFimOrcamento">
                    <label for="filtroNumeroOrcamento">Nº:</label>
                    <input type="number" id="filtroNumeroOrcamento" placeholder="Num." style="width: 70px;">
                    <label for="filtroAnoOrcamento">Ano:</label>
                    <input type="number" id="filtroAnoOrcamento" placeholder="Ano" style="width: 70px;">
                    <label for="filtroClienteOrcamento">Cliente:</label>
                    <input type="text" id="filtroClienteOrcamento" placeholder="Nome Cliente">
                    <!-- Botão de filtro agora é tratado pelo JS -->
                    <button type="button">Filtrar</button>
                </div>
                <div class="table-responsive">
                    <table id="tabela-orcamentos">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Data</th>
                                <th>Cliente</th>
                                <th>Total</th>
                                <th>Pedido Nº</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Linhas de orçamentos serão adicionadas aqui pelo JS -->
                        </tbody>
                    </table>
                </div>
            </section>
            <!-- ==== FIM SEÇÃO - ORÇAMENTOS GERADOS ==== -->

            <!-- ==== INÍCIO SEÇÃO - LISTA DE PEDIDOS ==== -->
            <section id="lista-pedidos" class="pagina" style="display:none;">
                <h2>Pedidos Realizados</h2>
                <hr class="subtitulo">
                <div class="filtro-data">
                    <label for="filtroDataInicioPedido">Início:</label>
                    <input type="date" id="filtroDataInicioPedido">
                    <label for="filtroDataFimPedido">Fim:</label>
                    <input type="date" id="filtroDataFimPedido">
                    <label for="filtroNumeroPedido">Nº:</label>
                    <input type="number" id="filtroNumeroPedido" placeholder="Num." style="width: 70px;">
                    <label for="filtroAnoPedido">Ano:</label>
                    <input type="number" id="filtroAnoPedido" placeholder="Ano" style="width: 70px;">
                    <label for="filtroClientePedido">Cliente:</label>
                    <input type="text" id="filtroClientePedido" placeholder="Nome Cliente">
                     <!-- Botão de filtro agora é tratado pelo JS -->
                    <button type="button">Filtrar</button>
                </div>
                <div class="table-responsive">
                    <table id="tabela-pedidos">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Data Pedido</th>
                                <th>Cliente</th>
                                <th>Total</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Linhas de pedidos serão adicionadas aqui pelo JS -->
                        </tbody>
                    </table>
                </div>
            </section>
            <!-- ==== FIM SEÇÃO - LISTA DE PEDIDOS ==== -->

            <!-- ==== INÍCIO SEÇÃO - FORMULÁRIO DE EDIÇÃO DE PEDIDO ==== -->
            <section id="form-edicao-pedido" class="pagina" style="display:none;">
                <h2>Editar Pedido</h2>
                <hr class="subtitulo">
                <form id="edicaoPedido">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataPedidoEdicao">Data do Pedido:</label>
                            <input type="date" id="dataPedidoEdicao" name="dataPedidoEdicao">
                        </div>
                        <div class="form-group">
                            <label for="dataEntregaEdicao">Data Prev. Entrega:</label>
                            <input type="date" id="dataEntregaEdicao" name="dataEntregaEdicao">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clienteEdicao">Cliente:</label>
                            <input type="text" id="clienteEdicao" name="clienteEdicao" placeholder="Nome do Cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="enderecoEdicao">Endereço:</label>
                            <input type="text" id="enderecoEdicao" name="enderecoEdicao" placeholder="Endereço do Cliente">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="temaEdicao">Tema:</label>
                            <input type="text" id="temaEdicao" name="temaEdicao" placeholder="Tema do Pedido">
                        </div>
                        <div class="form-group">
                            <label for="cidadeEdicao">Cidade:</label>
                            <input type="text" id="cidadeEdicao" name="cidadeEdicao" placeholder="Cidade do Cliente">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contatoEdicao">Telefone/Contato:</label> <!-- Label atualizada -->
                            <input type="text" id="contatoEdicao" name="contatoEdicao" placeholder="Telefone, Email, etc.">
                        </div>
                        <div class="form-group">
                            <label for="coresEdicao">Cores:</label>
                            <input type="text" id="coresEdicao" name="coresEdicao" placeholder="Cores Preferidas">
                        </div>
                    </div>
                    <hr class="tabela">
                     <h3>Produtos do Pedido</h3>
                    <div class="table-responsive">
                        <table id="tabelaProdutosEdicao">
                            <thead>
                                <tr>
                                    <th>Qtde</th>
                                    <th>Descrição do Produto</th>
                                    <th>Valor Unit.</th>
                                    <th>Valor Total</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Linhas de produtos serão adicionadas aqui pelo JS -->
                            </tbody>
                        </table>
                        <button type="button" id="btnAddProdutoEdicao">Adicionar Produto</button>
                    </div>
                    <hr class="final-tabela">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pagamento:</label>
                            <div>
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamentoEdicao" value="pix"> PIX</label>
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamentoEdicao" value="dinheiro"> Dinheiro</label>
                                <label style="display: inline-block; margin-right: 15px;"><input type="checkbox" name="pagamentoEdicao" value="cartaoCredito"> Cartão Crédito</label>
                                <label style="display: inline-block;"><input type="checkbox" name="pagamentoEdicao" value="cartaoDebito"> Cartão Débito</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="valorFreteEdicao">Valor do Frete (R$):</label>
                            <input type="text" id="valorFreteEdicao" name="valorFreteEdicao" value="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label for="valorPedidoEdicao">Valor Pedido (Base) (R$):</label>
                            <input type="text" id="valorPedidoEdicao" name="valorPedidoEdicao" value="R$ 0,00">
                        </div>
                    </div>
                     <div class="form-row valores-pedido"> <!-- Linha específica para Custo e Margem -->
                        <div class="form-group">
                            <label for="custoMaoDeObraEdicao">Custo M. Obra (R$):</label>
                            <input type="text" id="custoMaoDeObraEdicao" name="custoMaoDeObraEdicao" value="R$ 0,00">
                        </div>
                        <div class="form-group">
                            <label for="margemLucroEdicao">Margem Lucro (R$):</label>
                            <input type="text" id="margemLucroEdicao" name="margemLucroEdicao" value="R$ 0,00">
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group">
                            <label for="totalEdicao">Total Geral (Pedido + Frete) (R$):</label>
                            <input type="text" id="totalEdicao" name="totalEdicao" value="R$ 0,00" readonly class="campo-calculado">
                        </div>
                        <div class="form-group">
                            <label for="entradaEdicao">Entrada (R$):</label>
                            <input type="text" id="entradaEdicao" name="entradaEdicao" value="R$ 0,00">
                        </div>
                    </div>
                    <div class="form-row">
                         <div class="form-group" style="width: 48%; margin-right: 2%;"> <!-- Ajuste para alinhar -->
                            <label for="restanteEdicao">Restante (R$):</label>
                            <input type="text" id="restanteEdicao" name="restanteEdicao" value="R$ 0,00" readonly class="campo-calculado">
                        </div>
                    </div>

                    <!-- **** NOVO CAMPO PREVISÃO DE ENTREGA **** -->
                    <div class="form-row">
                        <div class="form-group" style="width: 100%; margin-right: 0;">
                            <label for="previsaoEntregaEdicao">Previsão de Entrega (Detalhes):</label>
                            <textarea id="previsaoEntregaEdicao" name="previsaoEntregaEdicao" rows="3" placeholder="Ex: Produção X dias, envio via Y, previsão chegada DD/MM, etc."></textarea>
                        </div>
                    </div>
                    <!-- **** FIM NOVO CAMPO **** -->

                    <div class="form-row">
                        <div class="form-group" style="width: 100%; margin-right: 0;">
                            <label for="observacoesEdicao">Observações Gerais:</label>
                            <textarea id="observacoesEdicao" name="observacoesEdicao" rows="4" placeholder="Detalhes adicionais, acordos, etc."></textarea>
                        </div>
                    </div>
                    <button type="button" id="btnSalvarPedidoEdicao">Salvar Alterações</button>
                </form>
            </section>
            <!-- ==== FIM SEÇÃO - FORMULÁRIO DE EDIÇÃO DE PEDIDO ==== -->

            <!-- ==== INÍCIO SEÇÃO - RELATÓRIO ==== -->
            <section id="relatorio" class="pagina" style="display:none;">
                <h2>Relatório de Pedidos</h2>
                 <hr class="subtitulo">
                <div class="filtro-data">
                    <label for="filtroDataInicio">Início:</label>
                    <input type="date" id="filtroDataInicio">
                    <label for="filtroDataFim">Fim:</label>
                    <input type="date" id="filtroDataFim">
                    <!-- Botão tratado pelo JS -->
                    <button type="button">Gerar Relatório</button>
                </div>
                <div id="relatorio-conteudo">
                    <p>Selecione o período e clique em "Gerar Relatório".</p>
                    <!-- Tabela de relatório será inserida aqui pelo JS -->
                </div>
                 <!-- Botão tratado pelo JS -->
                <button type="button" onclick="gerarRelatorioXLSX()">Exportar Relatório (XLSX)</button>
            </section>
            <!-- ==== FIM SEÇÃO - RELATÓRIO ==== -->

             <!-- ==== INÍCIO SEÇÃO - VISUALIZAR ORÇAMENTO (Placeholder) ==== -->
            <!-- Esta seção é apenas um placeholder, o conteúdo é gerado em orcamento.html -->
            <section id="visualizar-orcamento" class="pagina" style="display:none;">
                <h2>Visualizar Orçamento</h2>
                <p>A visualização do orçamento será aberta em uma nova janela.</p>
                <!-- O conteúdo real está em orcamento.html e é preenchido via JS -->
            </section>
            <!-- ==== FIM SEÇÃO - VISUALIZAR ORÇAMENTO ==== -->

        </div><!-- Fechamento da div #appContent -->
    </div><!-- Fechamento da div .container -->
</body>
</html>